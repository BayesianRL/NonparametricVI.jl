<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Getting Started · NonparametricVI.jl</title><meta name="title" content="Getting Started · NonparametricVI.jl"/><meta property="og:title" content="Getting Started · NonparametricVI.jl"/><meta property="twitter:title" content="Getting Started · NonparametricVI.jl"/><meta name="description" content="Documentation for NonparametricVI.jl."/><meta property="og:description" content="Documentation for NonparametricVI.jl."/><meta property="twitter:description" content="Documentation for NonparametricVI.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="NonparametricVI.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">NonparametricVI.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Homepage</a></li><li class="is-active"><a class="tocitem" href>Getting Started</a><ul class="internal"><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Using-with-Turing.jl-Probabilistic-Programs"><span>Using with Turing.jl Probabilistic Programs</span></a></li><li><a class="tocitem" href="#Using-with-LogDensityProblems"><span>Using with <code>LogDensityProblems</code></span></a></li></ul></li><li><a class="tocitem" href="../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Getting Started</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Getting Started</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Getting-Started"><a class="docs-heading-anchor" href="#Getting-Started">Getting Started</a><a id="Getting-Started-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-Started" title="Permalink"></a></h1><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>NonparametricVI.jl is under development, you can install the latest version using Pkg:</p><pre><code class="language-julia hljs">Pkg.add(url=&quot;https://github.com/BayesianRL/NonparametricVI.jl.git&quot;)</code></pre><p>Or the latest registered version from Julia general repository:</p><pre><code class="language-julia hljs">Pkg.add(&quot;NonparametricVI&quot;)</code></pre><h2 id="Using-with-Turing.jl-Probabilistic-Programs"><a class="docs-heading-anchor" href="#Using-with-Turing.jl-Probabilistic-Programs">Using with Turing.jl Probabilistic Programs</a><a id="Using-with-Turing.jl-Probabilistic-Programs-1"></a><a class="docs-heading-anchor-permalink" href="#Using-with-Turing.jl-Probabilistic-Programs" title="Permalink"></a></h2><h3 id="Example:-Linear-Regression"><a class="docs-heading-anchor" href="#Example:-Linear-Regression">Example: Linear Regression</a><a id="Example:-Linear-Regression-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-Linear-Regression" title="Permalink"></a></h3><p>Let&#39;s craft a toy regression problem:</p><pre><code class="language-julia hljs">using DynamicPPL
using NonparametricVI
using LinearAlgebra
using KernelFunctions
using CairoMakie

n = 100
X = 2rand(n) .- 1.0
y = 3X .+ 1 + randn(n)</code></pre><p>The generated problem looks like this:</p><p align="center">
    <img src="../assets/examples/linear_regression/data.png" width="400">
</p><p>We start by defining a simple Turing.jl model for regression and instantiate it:</p><pre><code class="language-julia hljs">@model function bayesian_regression(X, y)
    α ~ Normal(0.0, 1.0)
    β ~ Normal(0.0, 1.0)

    for i in eachindex(y)
        y[i] ~ Normal(α * X[i] + β, 0.5)
    end
end

model = bayesian_regression(X, y)</code></pre><p>To define the dynamics of Stein Variational Gradient Descent (SVGD), we need a positive-definite kernel. You can use all provided by <a href="https://github.com/JuliaGaussianProcesses/KernelFunctions.jl">KernelFunctions.jl</a>. We use a scaled squared exponential kernel. for more details on designing more complex kernels, check out <a href="https://github.com/JuliaGaussianProcesses/KernelFunctions.jl">KernelFunctions.jl</a> documentation:  </p><pre><code class="language-julia hljs">using KernelFunctions
kernel = SqExponentialKernel() ∘ ScaleTransform(0.3)</code></pre><p>Next we define the parameters of <code>SVGD</code>:  </p><pre><code class="language-julia hljs">dynamics = SVGD(K=kernel, η=0.003, batchsize=32)</code></pre><p>Nonparametric Variational Inference methods use a set of particles instead of a parametric family of distribution to approximate posterior (or any target) distribution. The <code>init</code> method creates the particles <code>pc</code>, in addition to an internal context <code>ctx</code> which will be used by the inference procedure.</p><pre><code class="language-julia hljs">pc, ctx = init(model, dynamics; n_particles=128)</code></pre><p><code>pc</code> is a simple struct containing position of particles. Using <code>get_samples</code> we can access the particles and plot them:</p><pre><code class="language-julia hljs">samples = get_samples(pc, ctx)
α_samples = [s[@varname(α)] for s in samples]
β_samples = [s[@varname(β)] for s in samples];</code></pre><p>Note that some Turing models may contain constrained parameters (e.g. positive, bounded, ...) while most inference methods are performed on an unconstrained space obtained by transforming the original denisty of parameters. The <code>get_samples</code> method transforms the particle positions back to the contrained space. Before running SVGD we can visualize the currest state of particles:  </p><p align="center">
    <img src="../assets/examples/linear_regression/particles_before_inference.png" width="400">
</p><p>Finally we can perform inference. Note the <code>infer!</code> method modifies the particles in-place.</p><pre><code class="language-julia hljs">infer!(pc, ctx; iters=200)</code></pre><p>After collecting samples with <code>get_samples</code> we can visualize the final result:</p><p align="center">
    <img src="../assets/examples/linear_regression/particles_after_inference.png" width="400">
</p><h2 id="Using-with-LogDensityProblems"><a class="docs-heading-anchor" href="#Using-with-LogDensityProblems">Using with <code>LogDensityProblems</code></a><a id="Using-with-LogDensityProblems-1"></a><a class="docs-heading-anchor-permalink" href="#Using-with-LogDensityProblems" title="Permalink"></a></h2><p>In addtion to Turing programs, you can use NonparametricVI for a custom Bayesian inference problem by implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl"><code>LogDensityProblems.jl</code></a> interface. For example here we define a toy unnormalized mixture density:</p><pre><code class="language-julia hljs">struct MixtureDensity end

function LogDensityProblems.capabilities(::Type{&lt;:MixtureDensity})
    LogDensityProblems.LogDensityOrder{0}()
end

LogDensityProblems.dimension(::MixtureDensity) = 2

function LogDensityProblems.logdensity(::MixtureDensity, x)
    log(0.25 * exp(-1/0.5 * norm(x-[-1.5, -1.5])^2) +
        0.25 * exp(-1/0.5 * norm(x-[-1.5,  1.5])^2) +
        0.25 * exp(-1/0.5 * norm(x-[ 1.5, -1.5])^2) +
        0.25 * exp(-1/0.5 * norm(x-[ 1.5,  1.5])^2))
end

ρ = MixtureDensity()</code></pre><p>Next we define the inference dynamics by choosing a custom kernel. It can be any kernel provided by <a href="https://github.com/JuliaGaussianProcesses/KernelFunctions.jl">KernelFunctions.jl</a>. Here we use a scaled version of the squared exponential kernel:</p><pre><code class="language-julia hljs">kernel = SqExponentialKernel() ∘ ScaleTransform(2.0)
dynamics = SVGD(K=kernel, η=0.5, batchsize=16)</code></pre><p>Now we create a set of particles that represent samples:</p><pre><code class="language-julia hljs">pc, ctx = init(ρ, dynamics; n_particles=512)</code></pre><p>We can access particle positions by <code>get_samples</code> and visualize the their current position:</p><pre><code class="language-julia hljs">S = get_samples(pc)</code></pre><p align="center">
    <img src="../assets/examples/mixture/particles_before_inference.png" width="512">
</p><p>Obviously the initial samples does not match the target density. Now we run the <code>SVGD</code> dynamics to adjust the samples:</p><pre><code class="language-julia hljs">infer!(pc, ctx; iters=100)
S = get_samples(pc)</code></pre><p>Finally we can check the terminal position of particles:</p><p align="center">
    <img src="../assets/examples/mixture/particles_after_inference.png" width="512">
</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Homepage</a><a class="docs-footer-nextpage" href="../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.9.0 on <span class="colophon-date" title="Wednesday 9 April 2025 20:03">Wednesday 9 April 2025</span>. Using Julia version 1.11.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
